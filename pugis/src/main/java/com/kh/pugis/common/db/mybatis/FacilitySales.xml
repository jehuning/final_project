<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="FacilitySales">
	
	<resultMap type="com.kh.pugis.service.consulting.domain.ByFacilitySales" id="result">
		<result property="purchase_date" column="purchase_date" />
		<result property="facility_name" column="facility_name" />
		<result property="customer_sales" column="customer_sales" />
		<result property="customer_id" column="customer_id" />
		<result property="ticket_pub_code" column="ticket_pub_code" />
		<result property="facility_code" column="facility_code" />
	</resultMap>
	
	<select id="getFacilitySales" resultMap="result">
		SELECT ticket_puchase.purchase_date 일자, facility_info.facility_name 부대시설, sum(CUSTOMER_SALES) 부대시설_매출
		FROM CUSTOMER_INFO
		JOIN TICKET_PUCHASE ON (customer_info.customer_id = ticket_puchase.customer_id)
        JOIN FACILITY_SALES ON (ticket_puchase.ticket_pub_code = facility_sales.ticket_pub_code)
        JOIN facility_info ON (facility_sales.facility_code = facility_info.faclility_code)
        group by ticket_puchase.purchase_date, facility_info.facility_name
        ORDER BY PURCHASE_DATE
	</select>

	<select id="getFacilitySalesSum" resultMap="result" parameterType="int">
	SELECT ticket_puchase.purchase_date 일자, facility_info.facility_name 부대시설, sum(CUSTOMER_SALES) 부대시설_매출
		FROM CUSTOMER_INFO
		JOIN TICKET_PUCHASE ON (customer_info.customer_id = ticket_puchase.customer_id)
        JOIN FACILITY_SALES ON (ticket_puchase.ticket_pub_code = facility_sales.ticket_pub_code)
        JOIN facility_info ON (facility_sales.facility_code = facility_info.faclility_code) 
        WHERE PURCHASE_DATE = #{PURCHASE_DATE}
        group by ticket_puchase.purchase_date, facility_info.facility_name
	</select>
		
</mapper>
