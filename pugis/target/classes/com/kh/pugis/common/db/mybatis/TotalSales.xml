<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="TotalSales">
	
	<resultMap type="com.kh.pugis.service.consulting.domain.TotalSales" id="result">
		<result property="customer_ticketSales" column="ticket_price" />
		<result property="customer_facilitySalse" column="customer_sales" />
		<result property="customer_id" column="customer_id" />
		<result property="sales_date" column="purchase_date" />
		<result property="total_sales" column="SUM" />
	</resultMap>

	<select id="getTotalSales" resultMap="result" parameterType="String">
		SELECT ticket_purchase.purchase_date, customer_info.customer_id, ticket_class_info.ticket_price,
		facility_sales.customer_sales, SUM(ticket_class_info.ticket_price + facility_sales.customer_sales) SUM  
      	FROM CUSTOMER_INFO
      	JOIN TICKET_PURCHASE ON (customer_info.customer_id = ticket_purchase.customer_id)
        JOIN TICKET_CLASS_INFO ON (ticket_purchase.ticket_class_code = ticket_class_info.ticket_class_code)
        JOIN facility_sales ON (ticket_purchase.ticket_pub_code = facility_sales.ticket_pub_code)
        JOIN facility_info ON (facility_sales.facility_code = facility_info.faclility_code)
        WHERE PURCHASE_DATE = #{purchase_date} 
        group by ticket_purchase.purchase_date, customer_info.customer_id, ticket_class_info.ticket_price, facility_sales.customer_sales
	</select>
		
</mapper>
